# Lawsyの薬事法特化カスタマイズ計画書

## 概要

この文書は、汎用法令検索システムLawsyを日本の薬事法（医薬品医療機器等法）に特化したシステムにカスタマイズするための計画書です。

## システムアーキテクチャ概要

### 現在のLawsyシステム構成

1. **データ処理パイプライン**
   - e-Gov XMLから法令データをパース
   - 法令をチャンク化（記事・項・号単位）
   - テキストのベクトル化（OpenAI text-embedding-3-small）
   - FAISSベクトルインデックスの構築

2. **検索機能**
   - ベクトル検索（法令データ）
   - Web検索（DuckDuckGo/Tavily/Google）
   - ハイブリッド検索結果の統合

3. **AI機能**
   - クエリリファインメント
   - クエリ拡張
   - レポート生成（OpenAI GPT-4）

4. **UI/UX**
   - Streamlitベースのウェブアプリケーション
   - 検索結果の可視化
   - レポート生成とエクスポート

## 薬事法特化カスタマイズ要件

### 1. データソースの特化

#### 法令データ
- **薬機法本文**: 医薬品、医療機器等の品質、有効性及び安全性の確保等に関する法律
- **関連省令**: 
  - GMP省令（医薬品の製造管理及び品質管理の基準に関する省令）
  - GCP省令（医薬品の臨床試験の実施の基準に関する省令）
  - GVP省令（医薬品の製造販売後安全管理の基準に関する省令）
  - GPSP省令（医薬品の製造販売後調査・試験の実施の基準に関する省令）
- **関連通知・事務連絡**: 厚生労働省・PMDA発出の薬事関連文書
- **ガイドライン**: 承認審査・品質管理に関する技術的ガイドライン

#### 取得方法
- e-Gov法令検索APIからの薬事関連法令選択的ダウンロード
- PMDA通知データベースからの文書収集
- 厚生労働省ウェブサイトからの関連文書収集

### 2. Web検索の最適化

#### ドメイン設定の変更
現在の設定：`["go.jp", "courts.go.jp", "shugiin.go.jp", "sangiin.go.jp", "cao.go.jp"]`

薬事法特化設定：
```python
["pmda.go.jp", "mhlw.go.jp", "nihs.go.jp", "jpma.or.jp", "jga.gr.jp", "jfrl.or.jp"]
```

- `pmda.go.jp`: 医薬品医療機器総合機構
- `mhlw.go.jp`: 厚生労働省
- `nihs.go.jp`: 国立医薬品食品衛生研究所
- `jpma.or.jp`: 日本製薬工業協会
- `jga.gr.jp`: 日本ジェネリック製薬協会
- `jfrl.or.jp`: 日本食品分析センター

### 3. 専門用語処理の強化

#### 薬事専門用語辞書
- **略語展開**: GMP→Good Manufacturing Practice, GCP→Good Clinical Practice等
- **同義語処理**: 治験↔臨床試験, 申請↔承認申請等
- **法令固有用語**: 製造販売業許可、製造業許可、適応外使用等

#### クエリ処理の改良
- QueryRefinerとQueryExpanderに薬事専門知識を統合
- 薬事法特有の検索パターンへの対応

### 4. UIカスタマイズ

#### ブランディング
- タイトル: "Lawsy" → "Lawsy Pharma"
- ロゴ・アイコンの薬事版への変更
- プレースホルダーテキスト: "薬事法について何でも聞いてください！"

#### 機能追加
- 薬事法検索テンプレート（承認申請、GMP査察、安全性情報等）
- 薬事カテゴリーフィルター
- 法令改正履歴の表示

## 実装計画

### フェーズ1: データ基盤構築

#### タスクチェックリスト

- [ ] **データソース収集: 薬機法・関連省令のXMLダウンロード**
  - e-Gov APIから薬機法（法令番号：昭和35年法律第145号→平成25年法律第84号）をダウンロード
  - 関連省令（GMP、GCP、GVP、GPSP省令）のXMLデータ取得
  - データ整合性の確認

- [ ] **データソース収集: PMDA通知データベースの調査**
  - PMDA通知検索システムの調査
  - 通知文書のスクレイピング可能性評価
  - APIの存在確認

- [ ] **データ処理パイプラインの実行(Makefile)**
  - 薬事法データでのチャンク化処理
  - ベクトル化とFAISSインデックス構築
  - データ品質確認

### フェーズ2: 検索機能の最適化

- [ ] **Web検索ドメイン設定の変更(config.py)**
  - `src/lawsy/app/config.py`のweb_search_domainsを薬事特化ドメインに変更
  - 設定の動作確認

- [ ] **薬事専門用語辞書の作成**
  - 薬事法関連の略語・同義語辞書作成
  - JSON/YAML形式での辞書ファイル作成
  - 辞書の妥当性検証

- [ ] **QueryRefiner/QueryExpanderへの専門用語統合**
  - 専門用語辞書を活用したクエリ処理の実装
  - 薬事法特有の検索パターンへの対応
  - 検索精度の評価

### フェーズ3: UI/UXの改善

- [ ] **UIテキスト・ロゴのカスタマイズ**
  - アプリケーションタイトルの変更
  - ロゴファイルの差し替え
  - プレースホルダーテキストの薬事法特化

- [ ] **薬事法検索テンプレートの追加**
  - 承認申請関連テンプレート
  - GMP査察関連テンプレート
  - 安全性情報関連テンプレート
  - 法令改正関連テンプレート

### フェーズ4: テスト・検証

- [ ] **システムテストと動作確認**
  - 薬事法関連クエリでの検索精度テスト
  - レポート生成品質の評価
  - パフォーマンステスト
  - ユーザビリティテスト

## 技術的実装詳細

### ファイル変更箇所

1. **設定ファイル**
   - `src/lawsy/app/config.py`: web_search_domainsの変更

2. **データ処理**
   - `Makefile`: 薬事法データ処理用の新規ターゲット追加
   - 新規: `src/lawsy/data/pharma_terms.json`: 薬事専門用語辞書

3. **AI機能**
   - `src/lawsy/ai/query_refiner.py`: 専門用語処理の追加
   - `src/lawsy/ai/query_expander.py`: 薬事法特化展開ロジックの追加

4. **UI**
   - `src/lawsy/app/app.py`: タイトル・アイコンの変更
   - `src/lawsy/app/research.py`: プレースホルダーテキストの変更
   - 新規: `src/lawsy/app/templates/`: 薬事法検索テンプレート

### 環境設定

```bash
# .env file additions for pharma customization
LAWSY_DOMAIN_FOCUS=pharma
LAWSY_PHARMA_TERMS_PATH=./src/lawsy/data/pharma_terms.json
```

## 期待される効果

1. **検索精度の向上**: 薬事法特化により関連度の高い検索結果を提供
2. **専門性の強化**: 薬事業界の専門用語・文脈に対応した高精度な分析
3. **業務効率化**: 薬事関連業務における法令調査時間の大幅短縮
4. **コンプライアンス支援**: 最新の薬事法令・通知への迅速なアクセス

## 運用・保守計画

1. **データ更新**: 月次での法令・通知データの更新
2. **専門用語辞書**: 四半期ごとの辞書メンテナンス
3. **検索精度**: 半年ごとの検索品質評価・改善
4. **ユーザーフィードバック**: 継続的な利用者フィードバック収集・反映

## リスク・課題

1. **データ取得**: PMDA通知データのスクレイピング制限
2. **専門性**: 薬事法の複雑性による検索精度の課題
3. **法令改正**: 頻繁な法令改正への追従体制
4. **ライセンス**: 第三者データ利用時のライセンス問題

---

**文書作成日**: 2025-08-13  
**バージョン**: 1.0  
**作成者**: Claude Code Assistant